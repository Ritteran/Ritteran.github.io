<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Income Tax Calculator FY 2024-25 | Complete ITR Tool</title>
    <meta name="description" content="Free Indian Income Tax Calculator with LTCG Indexation Tool, Depreciation Calculator, Surcharge & Marginal Relief. Budget 2024 updated rates.">
    <style>
        /* ============================================
           DESIGN SYSTEM TOKENS
           ============================================ */
        :root {
            /* Primary Colors */
            --color-primary-900: #1a1a2e;
            --color-primary-800: #16213e;
            --color-primary-700: #1f3460;
            --color-primary-500: #4a90d9;
            --color-primary-400: #6ba3e0;
            --color-primary-300: #7eb3f0;
            --color-primary-100: #e3f2fd;

            /* Accent Colors */
            --color-accent-orange: #FA5D29;
            --color-accent-green: #4caf50;
            --color-accent-yellow: #ffc107;
            --color-accent-red: #f44336;
            --color-accent-purple: #9c27b0;

            /* Semantic Colors */
            --color-old-regime: #2196f3;
            --color-new-regime: #4caf50;
            --color-savings: #FA5D29;

            /* Neutral Colors */
            --color-neutral-100: #ffffff;
            --color-neutral-200: #f8f9fa;
            --color-neutral-300: #e8e8e8;
            --color-neutral-400: #9e9e9e;
            --color-neutral-500: #666666;
            --color-neutral-600: #444444;
            --color-neutral-700: #333333;
            --color-neutral-800: #222222;

            /* Evidence Tier Colors */
            --tier-1: #4caf50;
            --tier-2: #2196f3;
            --tier-3: #ff9800;
            --tier-4: #ff5722;
            --tier-5: #f44336;

            /* Typography - Fluid Scaling */
            --font-size-xs: clamp(0.7rem, 0.65rem + 0.25vw, 0.8rem);
            --font-size-sm: clamp(0.8rem, 0.75rem + 0.25vw, 0.9rem);
            --font-size-base: clamp(0.9rem, 0.85rem + 0.25vw, 1rem);
            --font-size-lg: clamp(1rem, 0.95rem + 0.25vw, 1.125rem);
            --font-size-xl: clamp(1.125rem, 1rem + 0.5vw, 1.375rem);
            --font-size-2xl: clamp(1.25rem, 1.1rem + 0.75vw, 1.75rem);
            --font-size-3xl: clamp(1.5rem, 1.25rem + 1.25vw, 2.25rem);

            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;

            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.2);
            --shadow-xl: 0 20px 60px rgba(0,0,0,0.25);

            /* Borders */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;

            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-base: 0.3s ease;
            --transition-slow: 0.5s ease;
            --easing-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
            --easing-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ============================================
           CSS RESET & BASE
           ============================================ */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
            font-size: var(--font-size-base);
            line-height: 1.6;
            color: var(--color-neutral-700);
            background: linear-gradient(135deg, var(--color-primary-900) 0%, var(--color-primary-800) 100%);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* ============================================
           LAYOUT
           ============================================ */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-4);
        }

        /* ============================================
           HEADER
           ============================================ */
        .app-header {
            text-align: center;
            padding: var(--space-8) var(--space-4);
            color: var(--color-neutral-100);
        }

        .app-title {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            margin-bottom: var(--space-2);
            background: linear-gradient(135deg, #fff 0%, #a8d8ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-subtitle {
            font-size: var(--font-size-sm);
            color: #8892b0;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Budget Update Banner */
        .update-banner {
            background: linear-gradient(135deg, rgba(250, 93, 41, 0.15) 0%, rgba(250, 93, 41, 0.05) 100%);
            border: 1px solid var(--color-accent-orange);
            border-radius: var(--radius-md);
            padding: var(--space-3) var(--space-4);
            margin: var(--space-4) 0;
            font-size: var(--font-size-sm);
            color: #fff;
        }

        .update-banner strong { color: var(--color-accent-orange); }

        /* ============================================
           WIZARD STEPPER
           ============================================ */
        .wizard-container {
            background: var(--color-neutral-100);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
        }

        .wizard-header {
            background: linear-gradient(135deg, var(--color-primary-800) 0%, var(--color-primary-900) 100%);
            padding: var(--space-6);
        }

        .wizard-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .wizard-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 40px;
            right: 40px;
            height: 3px;
            background: rgba(255,255,255,0.2);
            z-index: 0;
        }

        .wizard-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-2);
            z-index: 1;
            cursor: pointer;
            transition: var(--transition-base);
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: rgba(255,255,255,0.5);
            transition: var(--transition-base);
        }

        .step-label {
            font-size: var(--font-size-xs);
            color: rgba(255,255,255,0.5);
            text-align: center;
            max-width: 80px;
            transition: var(--transition-base);
        }

        .wizard-step.active .step-circle {
            background: var(--color-accent-orange);
            border-color: var(--color-accent-orange);
            color: #fff;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(250, 93, 41, 0.5);
        }

        .wizard-step.active .step-label {
            color: #fff;
            font-weight: 600;
        }

        .wizard-step.completed .step-circle {
            background: var(--color-accent-green);
            border-color: var(--color-accent-green);
            color: #fff;
        }

        .wizard-step.completed .step-label {
            color: rgba(255,255,255,0.8);
        }

        .wizard-step.completed .step-circle::after {
            content: '‚úì';
        }

        .wizard-step.completed .step-number { display: none; }

        @media (max-width: 600px) {
            .wizard-steps { flex-wrap: wrap; gap: var(--space-4); }
            .wizard-steps::before { display: none; }
            .step-label { display: none; }
        }

        /* ============================================
           WIZARD CONTENT
           ============================================ */
        .wizard-content {
            padding: var(--space-8);
        }

        .wizard-step-content {
            display: none;
            animation: fadeIn 0.4s var(--easing-smooth);
        }

        .wizard-step-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--color-primary-900);
            margin-bottom: var(--space-2);
        }

        .step-description {
            font-size: var(--font-size-base);
            color: var(--color-neutral-500);
            margin-bottom: var(--space-6);
        }

        /* ============================================
           CARDS
           ============================================ */
        .card {
            background: var(--color-neutral-100);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-bottom: var(--space-4);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--color-neutral-300);
            transition: var(--transition-base);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--color-primary-300);
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--color-primary-900);
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 2px solid var(--color-neutral-300);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .card-title .icon {
            width: 24px;
            height: 24px;
            background: var(--color-primary-500);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: var(--font-size-sm);
        }

        /* ============================================
           ASSESSEE TYPE SELECTOR (Step 1)
           ============================================ */
        .assessee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .assessee-card {
            background: var(--color-neutral-200);
            border: 2px solid transparent;
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            text-align: center;
            cursor: pointer;
            transition: var(--transition-base);
        }

        .assessee-card:hover {
            background: var(--color-primary-100);
            border-color: var(--color-primary-300);
            transform: translateY(-2px);
        }

        .assessee-card.selected {
            background: linear-gradient(135deg, var(--color-primary-500) 0%, var(--color-primary-700) 100%);
            border-color: var(--color-primary-500);
            color: #fff;
            box-shadow: 0 4px 20px rgba(74, 144, 217, 0.3);
        }

        .assessee-icon {
            font-size: 2rem;
            margin-bottom: var(--space-2);
        }

        .assessee-label {
            font-weight: 600;
            font-size: var(--font-size-sm);
        }

        .assessee-desc {
            font-size: var(--font-size-xs);
            color: var(--color-neutral-500);
            margin-top: var(--space-1);
        }

        .assessee-card.selected .assessee-desc { color: rgba(255,255,255,0.8); }

        /* ============================================
           FORM ELEMENTS
           ============================================ */
        .form-row {
            display: grid;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .form-row.cols-2 { grid-template-columns: repeat(2, 1fr); }
        .form-row.cols-3 { grid-template-columns: repeat(3, 1fr); }
        .form-row.cols-4 { grid-template-columns: repeat(4, 1fr); }

        @media (max-width: 768px) {
            .form-row.cols-2,
            .form-row.cols-3,
            .form-row.cols-4 { grid-template-columns: 1fr; }
        }

        .form-group { margin-bottom: var(--space-4); }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--color-neutral-600);
            margin-bottom: var(--space-2);
            font-size: var(--font-size-sm);
        }

        .form-label .hint {
            font-weight: 400;
            color: var(--color-neutral-400);
            font-size: var(--font-size-xs);
        }

        .form-label .limit {
            display: block;
            color: var(--color-accent-orange);
            font-size: var(--font-size-xs);
            font-weight: 400;
            margin-top: var(--space-1);
        }

        .form-input, .form-select {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            border: 2px solid var(--color-neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            background: var(--color-neutral-100);
            transition: var(--transition-fast);
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--color-primary-500);
            box-shadow: 0 0 0 4px rgba(74, 144, 217, 0.1);
        }

        .form-input.error { border-color: var(--color-accent-red); }
        .form-input.success { border-color: var(--color-accent-green); }

        .form-input::placeholder { color: var(--color-neutral-400); }

        /* Currency Input */
        .input-currency {
            position: relative;
        }

        .input-currency::before {
            content: '‚Çπ';
            position: absolute;
            left: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-neutral-500);
            font-weight: 500;
        }

        .input-currency .form-input {
            padding-left: var(--space-8);
        }

        /* ============================================
           INCOME SOURCE CHECKBOXES (Step 2)
           ============================================ */
        .income-sources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
        }

        .income-source-card {
            background: var(--color-neutral-200);
            border: 2px solid transparent;
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            cursor: pointer;
            transition: var(--transition-base);
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
        }

        .income-source-card:hover {
            background: var(--color-primary-100);
            border-color: var(--color-primary-300);
        }

        .income-source-card.selected {
            background: linear-gradient(135deg, rgba(74, 144, 217, 0.1) 0%, rgba(74, 144, 217, 0.05) 100%);
            border-color: var(--color-primary-500);
        }

        .income-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--color-neutral-400);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: var(--transition-fast);
        }

        .income-source-card.selected .income-checkbox {
            background: var(--color-primary-500);
            border-color: var(--color-primary-500);
            color: #fff;
        }

        .income-checkbox::after {
            content: '‚úì';
            opacity: 0;
            transform: scale(0);
            transition: var(--transition-fast);
        }

        .income-source-card.selected .income-checkbox::after {
            opacity: 1;
            transform: scale(1);
        }

        .income-source-info h4 {
            font-size: var(--font-size-base);
            font-weight: 600;
            color: var(--color-primary-900);
            margin-bottom: var(--space-1);
        }

        .income-source-info p {
            font-size: var(--font-size-xs);
            color: var(--color-neutral-500);
        }

        .income-source-icon {
            font-size: 1.5rem;
            margin-bottom: var(--space-1);
        }

        /* ============================================
           SECTION ACCORDIONS
           ============================================ */
        .section-accordion {
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-4);
            overflow: hidden;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) var(--space-5);
            background: var(--color-neutral-200);
            cursor: pointer;
            transition: var(--transition-base);
        }

        .section-header:hover { background: var(--color-neutral-300); }

        .section-header h3 {
            font-size: var(--font-size-base);
            font-weight: 600;
            color: var(--color-primary-900);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .section-header .badge {
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .section-toggle {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--color-primary-500);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-base);
        }

        .section-header.open .section-toggle { transform: rotate(180deg); }

        .section-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s var(--easing-smooth);
        }

        .section-body.open {
            max-height: 2000px;
        }

        .section-body-inner {
            padding: var(--space-5);
            border-top: 1px solid var(--color-neutral-300);
        }

        /* ============================================
           EVIDENCE BADGES (Business Expenses)
           ============================================ */
        .evidence-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .evidence-badge.tier-1 { background: rgba(76, 175, 80, 0.15); color: var(--tier-1); }
        .evidence-badge.tier-2 { background: rgba(33, 150, 243, 0.15); color: var(--tier-2); }
        .evidence-badge.tier-3 { background: rgba(255, 152, 0, 0.15); color: var(--tier-3); }
        .evidence-badge.tier-4 { background: rgba(255, 87, 34, 0.15); color: var(--tier-4); }
        .evidence-badge.tier-5 { background: rgba(244, 67, 54, 0.15); color: var(--tier-5); }

        .tds-warning {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-2);
            background: rgba(255, 193, 7, 0.15);
            color: #f57c00;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .deduction-badge {
            display: inline-flex;
            align-items: center;
            padding: var(--space-1) var(--space-2);
            background: rgba(76, 175, 80, 0.15);
            color: var(--color-accent-green);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        /* ============================================
           EXPENSE CATEGORY (Business)
           ============================================ */
        .expense-category {
            background: var(--color-neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            margin-bottom: var(--space-4);
            border-left: 4px solid var(--color-primary-500);
        }

        .expense-category-header {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .expense-category-number {
            width: 28px;
            height: 28px;
            background: var(--color-primary-500);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-sm);
            font-weight: 600;
        }

        .expense-category-title {
            font-size: var(--font-size-base);
            font-weight: 600;
            color: var(--color-primary-900);
        }

        .expense-category.tier-1 { border-left-color: var(--tier-1); }
        .expense-category.tier-2 { border-left-color: var(--tier-2); }
        .expense-category.tier-3 { border-left-color: var(--tier-3); }
        .expense-category.tier-4 { border-left-color: var(--tier-4); }
        .expense-category.tier-5 { border-left-color: var(--tier-5); }

        /* ============================================
           BUTTONS
           ============================================ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-base);
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary-500) 0%, var(--color-primary-700) 100%);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(74, 144, 217, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--color-accent-green) 0%, #388e3c 100%);
            color: #fff;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: var(--color-neutral-200);
            color: var(--color-neutral-600);
            border: 2px solid var(--color-neutral-300);
        }

        .btn-secondary:hover {
            background: var(--color-neutral-300);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--color-accent-red) 0%, #d32f2f 100%);
            color: #fff;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--color-primary-500);
            color: var(--color-primary-500);
        }

        .btn-outline:hover {
            background: var(--color-primary-500);
            color: #fff;
        }

        .btn-lg {
            padding: var(--space-4) var(--space-8);
            font-size: var(--font-size-lg);
        }

        .btn-sm {
            padding: var(--space-2) var(--space-4);
            font-size: var(--font-size-sm);
        }

        .btn-full { width: 100%; }

        /* ============================================
           WIZARD NAVIGATION
           ============================================ */
        .wizard-nav {
            display: flex;
            justify-content: space-between;
            padding-top: var(--space-6);
            border-top: 1px solid var(--color-neutral-300);
            margin-top: var(--space-6);
        }

        /* ============================================
           ALERTS & INFO BOXES
           ============================================ */
        .alert {
            padding: var(--space-4);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-4);
            font-size: var(--font-size-sm);
        }

        .alert-info {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid var(--color-old-regime);
            color: #1565c0;
        }

        .alert-success {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--color-accent-green);
            color: #2e7d32;
        }

        .alert-warning {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid var(--color-accent-yellow);
            color: #e65100;
        }

        .alert-danger {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--color-accent-red);
            color: #c62828;
        }

        /* ============================================
           RESULTS COMPARISON
           ============================================ */
        .results-comparison {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        @media (max-width: 768px) {
            .results-comparison { grid-template-columns: 1fr; }
        }

        .regime-card {
            background: var(--color-neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            position: relative;
            transition: var(--transition-base);
        }

        .regime-card.recommended {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%);
            border: 2px solid var(--color-accent-green);
        }

        .regime-card.recommended::before {
            content: '‚úì RECOMMENDED';
            position: absolute;
            top: -12px;
            right: var(--space-4);
            background: var(--color-accent-green);
            color: #fff;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .regime-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--color-primary-900);
            margin-bottom: var(--space-4);
        }

        .tax-amount {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--color-primary-900);
        }

        .tax-label {
            font-size: var(--font-size-sm);
            color: var(--color-neutral-500);
            margin-bottom: var(--space-4);
        }

        .tax-breakdown {
            border-top: 1px solid var(--color-neutral-300);
            padding-top: var(--space-4);
        }

        .breakdown-row {
            display: flex;
            justify-content: space-between;
            padding: var(--space-2) 0;
            font-size: var(--font-size-sm);
        }

        .breakdown-row span:first-child { color: var(--color-neutral-500); }
        .breakdown-row span:last-child { font-weight: 500; }

        .savings-banner {
            background: linear-gradient(135deg, var(--color-accent-green) 0%, #388e3c 100%);
            color: #fff;
            padding: var(--space-6);
            border-radius: var(--radius-lg);
            text-align: center;
        }

        .savings-amount {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--space-2);
        }

        /* ============================================
           SUMMARY CARDS (Step 5)
           ============================================ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .summary-card {
            background: var(--color-neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            text-align: center;
        }

        .summary-card-label {
            font-size: var(--font-size-sm);
            color: var(--color-neutral-500);
            margin-bottom: var(--space-2);
        }

        .summary-card-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--color-primary-900);
        }

        /* ============================================
           REGIME TOGGLE
           ============================================ */
        .regime-toggle {
            display: flex;
            background: var(--color-neutral-200);
            border-radius: var(--radius-full);
            padding: var(--space-1);
            margin-bottom: var(--space-6);
        }

        .regime-toggle-btn {
            flex: 1;
            padding: var(--space-3) var(--space-6);
            border: none;
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: 600;
            cursor: pointer;
            background: transparent;
            color: var(--color-neutral-500);
            transition: var(--transition-base);
        }

        .regime-toggle-btn.active {
            background: var(--color-primary-500);
            color: #fff;
            box-shadow: var(--shadow-md);
        }

        /* ============================================
           TABLES
           ============================================ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--font-size-sm);
        }

        .data-table th, .data-table td {
            padding: var(--space-3) var(--space-4);
            text-align: left;
            border-bottom: 1px solid var(--color-neutral-300);
        }

        .data-table th {
            background: var(--color-primary-900);
            color: #fff;
            font-weight: 600;
        }

        .data-table tr:nth-child(even) { background: var(--color-neutral-200); }
        .data-table tr:hover { background: var(--color-primary-100); }

        /* ============================================
           HIDDEN UTILITY
           ============================================ */
        .hidden { display: none !important; }

        /* ============================================
           DISCLAIMER
           ============================================ */
        .disclaimer {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid var(--color-accent-yellow);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            margin-top: var(--space-6);
            font-size: var(--font-size-sm);
            color: #856404;
        }

        /* ============================================
           PRINT STYLES
           ============================================ */
        @media print {
            body { background: #fff; }
            .wizard-header, .wizard-nav, .btn { display: none; }
            .wizard-container { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1 class="app-title">Indian Income Tax Calculator</h1>
            <p class="app-subtitle">FY 2024-25 (AY 2025-26) | Budget 2024 Updated Rates | Complete ITR Tool</p>

            <div class="update-banner">
                <strong>Budget 2024 Updates (Effective 23 July 2024):</strong>
                STCG on Equity: 15% ‚Üí <strong>20%</strong> |
                LTCG on Equity: 10% ‚Üí <strong>12.5%</strong> (Exemption: ‚Çπ1L ‚Üí <strong>‚Çπ1.25L</strong>) |
                Other LTCG: 20% with indexation ‚Üí <strong>12.5% without indexation</strong>
            </div>
        </header>

        <!-- Wizard Container -->
        <div class="wizard-container">
            <!-- Wizard Steps Header -->
            <div class="wizard-header">
                <div class="wizard-steps">
                    <div class="wizard-step active" data-step="1" onclick="goToStep(1)">
                        <div class="step-circle"><span class="step-number">1</span></div>
                        <div class="step-label">Profile</div>
                    </div>
                    <div class="wizard-step" data-step="2" onclick="goToStep(2)">
                        <div class="step-circle"><span class="step-number">2</span></div>
                        <div class="step-label">Income Sources</div>
                    </div>
                    <div class="wizard-step" data-step="3" onclick="goToStep(3)">
                        <div class="step-circle"><span class="step-number">3</span></div>
                        <div class="step-label">Income Details</div>
                    </div>
                    <div class="wizard-step" data-step="4" onclick="goToStep(4)">
                        <div class="step-circle"><span class="step-number">4</span></div>
                        <div class="step-label">Deductions</div>
                    </div>
                    <div class="wizard-step" data-step="5" onclick="goToStep(5)">
                        <div class="step-circle"><span class="step-number">5</span></div>
                        <div class="step-label">Results</div>
                    </div>
                </div>
            </div>

            <!-- Wizard Content -->
            <div class="wizard-content">
                <!-- STEP 1: Profile Setup -->
                <div class="wizard-step-content active" id="step-1">
                    <h2 class="step-title">Profile Setup</h2>
                    <p class="step-description">Tell us about yourself to determine the applicable tax rules and ITR form.</p>

                    <!-- Assessee Type -->
                    <div class="card">
                        <h3 class="card-title"><span class="icon">üë§</span> Assessee Type</h3>
                        <div class="assessee-grid">
                            <div class="assessee-card selected" data-type="individual" onclick="selectAssesseeType(this)">
                                <div class="assessee-icon">üë§</div>
                                <div class="assessee-label">Individual</div>
                                <div class="assessee-desc">Salaried, Self-employed</div>
                            </div>
                            <div class="assessee-card" data-type="huf" onclick="selectAssesseeType(this)">
                                <div class="assessee-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                                <div class="assessee-label">HUF</div>
                                <div class="assessee-desc">Hindu Undivided Family</div>
                            </div>
                            <div class="assessee-card" data-type="firm" onclick="selectAssesseeType(this)">
                                <div class="assessee-icon">ü§ù</div>
                                <div class="assessee-label">Firm</div>
                                <div class="assessee-desc">Partnership Firm</div>
                            </div>
                            <div class="assessee-card" data-type="llp" onclick="selectAssesseeType(this)">
                                <div class="assessee-icon">üè¢</div>
                                <div class="assessee-label">LLP</div>
                                <div class="assessee-desc">Limited Liability Partnership</div>
                            </div>
                            <div class="assessee-card" data-type="company" onclick="selectAssesseeType(this)">
                                <div class="assessee-icon">üèõÔ∏è</div>
                                <div class="assessee-label">Company</div>
                                <div class="assessee-desc">Private / Public Ltd</div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Details -->
                    <div class="card" id="individual-details">
                        <h3 class="card-title"><span class="icon">üìã</span> Additional Details</h3>
                        <div class="form-row cols-3">
                            <div class="form-group">
                                <label class="form-label">Residential Status</label>
                                <select class="form-select" id="residentialStatus">
                                    <option value="resident">Resident</option>
                                    <option value="nonresident">Non-Resident</option>
                                    <option value="rnor">Resident but Not Ordinarily Resident</option>
                                </select>
                            </div>
                            <div class="form-group" id="age-group-field">
                                <label class="form-label">Age Group</label>
                                <select class="form-select" id="ageGroup">
                                    <option value="general">Below 60 years</option>
                                    <option value="senior">60-80 years (Senior Citizen)</option>
                                    <option value="supersenior">Above 80 years (Super Senior)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Financial Year</label>
                                <select class="form-select" id="financialYear">
                                    <option value="2024-25" selected>FY 2024-25 (AY 2025-26)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Tax Regime Preference -->
                    <div class="card">
                        <h3 class="card-title"><span class="icon">‚öñÔ∏è</span> Tax Regime Preference</h3>
                        <div class="alert alert-info">
                            <strong>Note:</strong> New Tax Regime is default from FY 2023-24. You can opt for Old Regime to claim deductions under Chapter VI-A.
                        </div>
                        <div class="regime-toggle">
                            <button class="regime-toggle-btn active" data-regime="new" onclick="selectRegime('new')">New Tax Regime</button>
                            <button class="regime-toggle-btn" data-regime="old" onclick="selectRegime('old')">Old Tax Regime</button>
                        </div>
                        <div class="form-row cols-2">
                            <div>
                                <h4 style="margin-bottom: var(--space-2); color: var(--color-new-regime);">New Regime Benefits</h4>
                                <ul style="font-size: var(--font-size-sm); color: var(--color-neutral-500); padding-left: var(--space-5);">
                                    <li>Lower tax rates</li>
                                    <li>‚Çπ75,000 standard deduction</li>
                                    <li>No rebate filing required up to ‚Çπ7L</li>
                                    <li>Simpler compliance</li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="margin-bottom: var(--space-2); color: var(--color-old-regime);">Old Regime Benefits</h4>
                                <ul style="font-size: var(--font-size-sm); color: var(--color-neutral-500); padding-left: var(--space-5);">
                                    <li>80C deductions (‚Çπ1.5L)</li>
                                    <li>HRA exemption</li>
                                    <li>Home loan interest (‚Çπ2L)</li>
                                    <li>80D health insurance</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="wizard-nav">
                        <div></div>
                        <button class="btn btn-primary btn-lg" onclick="nextStep()">
                            Continue to Income Sources ‚Üí
                        </button>
                    </div>
                </div>

                <!-- STEP 2: Income Sources -->
                <div class="wizard-step-content" id="step-2">
                    <h2 class="step-title">Select Your Income Sources</h2>
                    <p class="step-description">Choose which types of income you have. We'll only show relevant sections based on your selection.</p>

                    <div class="alert alert-info">
                        <strong>Tip:</strong> Select all applicable income sources. The calculator will determine the appropriate ITR form based on your selections.
                    </div>

                    <div class="income-sources-grid">
                        <div class="income-source-card" data-source="salary" onclick="toggleIncomeSource(this)">
                            <div class="income-checkbox"></div>
                            <div class="income-source-info">
                                <div class="income-source-icon">üíº</div>
                                <h4>Salary Income</h4>
                                <p>Employment income, allowances, perquisites, pension</p>
                            </div>
                        </div>
                        <div class="income-source-card" data-source="house" onclick="toggleIncomeSource(this)">
                            <div class="income-checkbox"></div>
                            <div class="income-source-info">
                                <div class="income-source-icon">üè†</div>
                                <h4>House Property</h4>
                                <p>Rental income, home loan interest deduction</p>
                            </div>
                        </div>
                        <div class="income-source-card" data-source="business" onclick="toggleIncomeSource(this)">
                            <div class="income-checkbox"></div>
                            <div class="income-source-info">
                                <div class="income-source-icon">üìä</div>
                                <h4>Business / Profession</h4>
                                <p>Self-employed, freelance, trading, professional fees</p>
                            </div>
                        </div>
                        <div class="income-source-card" data-source="capital" onclick="toggleIncomeSource(this)">
                            <div class="income-checkbox"></div>
                            <div class="income-source-info">
                                <div class="income-source-icon">üìà</div>
                                <h4>Capital Gains</h4>
                                <p>Stocks, mutual funds, property sale, crypto</p>
                            </div>
                        </div>
                        <div class="income-source-card" data-source="other" onclick="toggleIncomeSource(this)">
                            <div class="income-checkbox"></div>
                            <div class="income-source-info">
                                <div class="income-source-icon">üí∞</div>
                                <h4>Other Sources</h4>
                                <p>Interest, dividends, lottery, gifts, royalty</p>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-warning hidden" id="no-source-warning">
                        Please select at least one income source to continue.
                    </div>

                    <!-- Navigation -->
                    <div class="wizard-nav">
                        <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button class="btn btn-primary btn-lg" onclick="nextStep()">
                            Continue to Income Details ‚Üí
                        </button>
                    </div>
                </div>

                <!-- STEP 3: Income Details (Placeholder - will be dynamically populated) -->
                <div class="wizard-step-content" id="step-3">
                    <h2 class="step-title">Enter Income Details</h2>
                    <p class="step-description">Fill in the details for each income source you selected.</p>

                    <div id="income-sections-container">
                        <!-- Dynamically populated based on Step 2 selections -->
                        <div class="alert alert-info">
                            Please complete Step 2 first to see relevant income sections.
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="wizard-nav">
                        <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button class="btn btn-primary btn-lg" onclick="nextStep()">
                            Continue to Deductions ‚Üí
                        </button>
                    </div>
                </div>

                <!-- STEP 4: Deductions -->
                <div class="wizard-step-content" id="step-4">
                    <h2 class="step-title">Claim Deductions</h2>
                    <p class="step-description">Enter your investments and expenses to reduce taxable income under Old Tax Regime.</p>

                    <div class="alert alert-warning" id="deductions-new-regime-warning">
                        <strong>Note:</strong> You've selected New Tax Regime. Most deductions below are not available in the New Regime.
                        Switch to Old Regime in Step 1 if you want to claim these deductions.
                    </div>

                    <div id="deductions-container">
                        <!-- Deduction sections will be populated here -->
                        <div class="alert alert-info">
                            Deductions will be shown based on your selected tax regime.
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="wizard-nav">
                        <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button class="btn btn-success btn-lg" onclick="calculateAndShowResults()">
                            Calculate Tax ‚Üí
                        </button>
                    </div>
                </div>

                <!-- STEP 5: Results -->
                <div class="wizard-step-content" id="step-5">
                    <h2 class="step-title">Your Tax Summary</h2>
                    <p class="step-description">Compare tax liability under both regimes and see which one saves you more.</p>

                    <!-- Summary Cards -->
                    <div class="summary-grid">
                        <div class="summary-card">
                            <div class="summary-card-label">Gross Total Income</div>
                            <div class="summary-card-value" id="summary-gti">‚Çπ0</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">Total Deductions</div>
                            <div class="summary-card-value" id="summary-deductions">‚Çπ0</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">Taxable Income (Old)</div>
                            <div class="summary-card-value" id="summary-taxable-old">‚Çπ0</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-card-label">Taxable Income (New)</div>
                            <div class="summary-card-value" id="summary-taxable-new">‚Çπ0</div>
                        </div>
                    </div>

                    <!-- Regime Comparison -->
                    <div class="results-comparison">
                        <div class="regime-card" id="new-regime-result">
                            <h3 class="regime-title" style="color: var(--color-new-regime);">New Tax Regime</h3>
                            <div class="tax-amount" id="new-tax-total">‚Çπ0</div>
                            <div class="tax-label">Total Tax Payable</div>
                            <div class="tax-breakdown">
                                <div class="breakdown-row">
                                    <span>Basic Tax</span>
                                    <span id="new-basic-tax">‚Çπ0</span>
                                </div>
                                <div class="breakdown-row">
                                    <span>Surcharge</span>
                                    <span id="new-surcharge">‚Çπ0</span>
                                </div>
                                <div class="breakdown-row">
                                    <span>Marginal Relief</span>
                                    <span id="new-marginal">‚Çπ0</span>
                                </div>
                                <div class="breakdown-row">
                                    <span>Health & Education Cess (4%)</span>
                                    <span id="new-cess">‚Çπ0</span>
                                </div>
                            </div>
                        </div>
                        <div class="regime-card" id="old-regime-result">
                            <h3 class="regime-title" style="color: var(--color-old-regime);">Old Tax Regime</h3>
                            <div class="tax-amount" id="old-tax-total">‚Çπ0</div>
                            <div class="tax-label">Total Tax Payable</div>
                            <div class="tax-breakdown">
                                <div class="breakdown-row">
                                    <span>Basic Tax</span>
                                    <span id="old-basic-tax">‚Çπ0</span>
                                </div>
                                <div class="breakdown-row">
                                    <span>Surcharge</span>
                                    <span id="old-surcharge">‚Çπ0</span>
                                </div>
                                <div class="breakdown-row">
                                    <span>Marginal Relief</span>
                                    <span id="old-marginal">‚Çπ0</span>
                                </div>
                                <div class="breakdown-row">
                                    <span>Health & Education Cess (4%)</span>
                                    <span id="old-cess">‚Çπ0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Savings Banner -->
                    <div class="savings-banner" id="savings-banner">
                        <div class="savings-amount" id="savings-amount">You Save ‚Çπ0</div>
                        <div id="savings-text">by choosing the recommended tax regime</div>
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; gap: var(--space-4); justify-content: center; margin-top: var(--space-6);">
                        <button class="btn btn-outline" onclick="window.print()">üñ®Ô∏è Print</button>
                        <button class="btn btn-secondary" onclick="goToStep(1)">üîÑ Start Over</button>
                    </div>

                    <!-- Disclaimer -->
                    <div class="disclaimer">
                        <strong>Disclaimer:</strong> This calculator provides estimates based on Income Tax Act FY 2024-25 (Budget 2024 updated).
                        Consult a qualified CA for accurate filing. Special rates apply for Capital Gains and Lottery income.
                        Marginal relief may apply at surcharge thresholds.
                    </div>

                    <!-- Navigation -->
                    <div class="wizard-nav">
                        <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back to Deductions</button>
                        <div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // STATE MANAGEMENT
        // ============================================
        const TaxState = {
            currentStep: 1,
            assesseeType: 'individual',
            residentialStatus: 'resident',
            ageGroup: 'general',
            financialYear: '2024-25',
            regimePreference: 'new',

            incomeSources: {
                salary: false,
                house: false,
                business: false,
                capital: false,
                other: false
            },

            // Income data will be added as user fills forms
            salary: {},
            house: { properties: [] },
            business: { type: 'none' },
            capital: {},
            other: {},

            deductions: {},
            assets: [],
            results: null
        };

        // ============================================
        // CONFIGURATION
        // ============================================
        const TaxConfig = {
            CII_TABLE: {
                '2001-02': 100, '2002-03': 105, '2003-04': 109, '2004-05': 113,
                '2005-06': 117, '2006-07': 122, '2007-08': 129, '2008-09': 137,
                '2009-10': 148, '2010-11': 167, '2011-12': 184, '2012-13': 200,
                '2013-14': 220, '2014-15': 240, '2015-16': 254, '2016-17': 264,
                '2017-18': 272, '2018-19': 280, '2019-20': 289, '2020-21': 301,
                '2021-22': 317, '2022-23': 331, '2023-24': 348, '2024-25': 363
            },

            DEP_RATES: {
                'building5': { name: 'Building (Residential)', rate: 0.05 },
                'building10': { name: 'Building (Others)', rate: 0.10 },
                'furniture': { name: 'Furniture & Fittings', rate: 0.10 },
                'plant15': { name: 'Plant & Machinery', rate: 0.15 },
                'vehicle15': { name: 'Motor Vehicles', rate: 0.15 },
                'vehicle30': { name: 'Commercial Vehicles', rate: 0.30 },
                'computer': { name: 'Computers & Software', rate: 0.40 },
                'intangible': { name: 'Intangible Assets', rate: 0.25 },
                'energy': { name: 'Energy Saving Devices', rate: 0.40 }
            },

            DEDUCTION_LIMITS: {
                '80C': 150000,
                '80CCD1B': 50000,
                '80D_self_general': 25000,
                '80D_self_senior': 50000,
                '80D_parents': 50000,
                '80TTA': 10000,
                '80TTB': 50000,
                '80E': Infinity,
                '80EE': 50000,
                '80G': Infinity
            }
        };

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function formatCurrency(amount) {
            return '‚Çπ' + Math.round(amount).toLocaleString('en-IN');
        }

        function getVal(id) {
            const el = document.getElementById(id);
            return el ? (parseFloat(el.value) || 0) : 0;
        }

        function saveState() {
            localStorage.setItem('indianTaxCalculator_v2', JSON.stringify(TaxState));
        }

        function loadState() {
            const saved = localStorage.getItem('indianTaxCalculator_v2');
            if (saved) {
                try {
                    Object.assign(TaxState, JSON.parse(saved));
                } catch (e) {
                    console.log('Could not load saved state');
                }
            }
        }

        // ============================================
        // WIZARD NAVIGATION
        // ============================================
        function goToStep(step) {
            if (step < 1 || step > 5) return;

            // Update state
            TaxState.currentStep = step;

            // Update step indicators
            document.querySelectorAll('.wizard-step').forEach((el, index) => {
                el.classList.remove('active', 'completed');
                if (index + 1 < step) {
                    el.classList.add('completed');
                } else if (index + 1 === step) {
                    el.classList.add('active');
                }
            });

            // Show correct content
            document.querySelectorAll('.wizard-step-content').forEach((el, index) => {
                el.classList.remove('active');
                if (index + 1 === step) {
                    el.classList.add('active');
                }
            });

            // Special handling for each step
            if (step === 3) {
                renderIncomeSections();
            } else if (step === 4) {
                renderDeductionsSections();
            } else if (step === 5) {
                calculateAndShowResults();
            }

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

            saveState();
        }

        function nextStep() {
            // Validation for step 2
            if (TaxState.currentStep === 2) {
                const hasSource = Object.values(TaxState.incomeSources).some(v => v);
                if (!hasSource) {
                    document.getElementById('no-source-warning').classList.remove('hidden');
                    return;
                }
                document.getElementById('no-source-warning').classList.add('hidden');
            }

            goToStep(TaxState.currentStep + 1);
        }

        function prevStep() {
            goToStep(TaxState.currentStep - 1);
        }

        // ============================================
        // STEP 1: PROFILE SETUP
        // ============================================
        function selectAssesseeType(element) {
            // Update UI
            document.querySelectorAll('.assessee-card').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');

            // Update state
            TaxState.assesseeType = element.dataset.type;

            // Show/hide age group based on type
            const ageField = document.getElementById('age-group-field');
            if (TaxState.assesseeType === 'individual') {
                ageField.classList.remove('hidden');
            } else {
                ageField.classList.add('hidden');
            }

            saveState();
        }

        function selectRegime(regime) {
            TaxState.regimePreference = regime;

            document.querySelectorAll('.regime-toggle-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.regime === regime) {
                    btn.classList.add('active');
                }
            });

            saveState();
        }

        // ============================================
        // STEP 2: INCOME SOURCE SELECTION
        // ============================================
        function toggleIncomeSource(element) {
            const source = element.dataset.source;

            // Toggle selection
            element.classList.toggle('selected');
            TaxState.incomeSources[source] = element.classList.contains('selected');

            // Hide warning if at least one source selected
            const hasSource = Object.values(TaxState.incomeSources).some(v => v);
            if (hasSource) {
                document.getElementById('no-source-warning').classList.add('hidden');
            }

            saveState();
        }

        // ============================================
        // STEP 3: INCOME DETAILS (Dynamic Rendering)
        // ============================================
        function renderIncomeSections() {
            const container = document.getElementById('income-sections-container');
            let html = '';

            if (TaxState.incomeSources.salary) {
                html += renderSalarySection();
            }
            if (TaxState.incomeSources.house) {
                html += renderHousePropertySection();
            }
            if (TaxState.incomeSources.business) {
                html += renderBusinessSection();
            }
            if (TaxState.incomeSources.capital) {
                html += renderCapitalGainsSection();
            }
            if (TaxState.incomeSources.other) {
                html += renderOtherSourcesSection();
            }

            if (!html) {
                html = '<div class="alert alert-warning">Please go back to Step 2 and select at least one income source.</div>';
            }

            container.innerHTML = html;
            attachInputListeners();
        }

        function renderSalarySection() {
            return `
                <div class="section-accordion">
                    <div class="section-header open" onclick="toggleSectionAccordion(this)">
                        <h3>üíº Salary Income (Section 15-17)</h3>
                        <div class="section-toggle">‚ñº</div>
                    </div>
                    <div class="section-body open">
                        <div class="section-body-inner">
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">Basic Salary (Annual)</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="basicSalary" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Dearness Allowance (DA)</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="da" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row cols-3">
                                <div class="form-group">
                                    <label class="form-label">House Rent Allowance (HRA)</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="hra" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Actual Rent Paid (Annual)</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="actualRent" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">City Type</label>
                                    <select class="form-select" id="cityType">
                                        <option value="metro">Metro (50%)</option>
                                        <option value="nonmetro">Non-Metro (40%)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row cols-3">
                                <div class="form-group">
                                    <label class="form-label">Leave Travel Allowance (LTA)</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="lta" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Special Allowances (Taxable)</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="specialAllowance" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Bonus / Commission</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="salaryBonus" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">Employer's PF Contribution</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="employerPF" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Perquisites Value (Sec 17(2))</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="perquisites" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-success" id="salary-summary">
                                <strong>Salary Summary:</strong> Gross: ‚Çπ0 | HRA Exemption: ‚Çπ0 | <strong>Net Taxable: ‚Çπ0</strong>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHousePropertySection() {
            return `
                <div class="section-accordion">
                    <div class="section-header" onclick="toggleSectionAccordion(this)">
                        <h3>üè† House Property Income (Section 22-27)</h3>
                        <div class="section-toggle">‚ñº</div>
                    </div>
                    <div class="section-body">
                        <div class="section-body-inner">
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">Property Type</label>
                                    <select class="form-select" id="propertyType">
                                        <option value="selfoccupied">Self-Occupied</option>
                                        <option value="letout">Let Out</option>
                                        <option value="deemed">Deemed Let Out</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Annual Rent Received</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="annualRent" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">Municipal Taxes Paid</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="municipalTax" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        Home Loan Interest (Sec 24b)
                                        <span class="limit">Max ‚Çπ2L for self-occupied</span>
                                    </label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="homeLoanInterest" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-success" id="house-summary">
                                <strong>House Property:</strong> Net Income: ‚Çπ0
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderBusinessSection() {
            return `
                <div class="section-accordion">
                    <div class="section-header" onclick="toggleSectionAccordion(this)">
                        <h3>üìä Business / Profession Income (Section 28-44)</h3>
                        <div class="section-toggle">‚ñº</div>
                    </div>
                    <div class="section-body">
                        <div class="section-body-inner">
                            <div class="form-group">
                                <label class="form-label">Business Type</label>
                                <select class="form-select" id="businessType" onchange="toggleBusinessType()">
                                    <option value="presumptive44AD">Presumptive - Sec 44AD (Business)</option>
                                    <option value="presumptive44ADA">Presumptive - Sec 44ADA (Profession)</option>
                                    <option value="regular">Regular Business (Books)</option>
                                </select>
                            </div>

                            <!-- Presumptive 44AD -->
                            <div id="section-44ad">
                                <div class="alert alert-info">
                                    <strong>Section 44AD:</strong> For businesses with turnover up to ‚Çπ3Cr (if 95% digital) or ‚Çπ2Cr.
                                    Digital receipts taxed at 6%, cash at 8%.
                                </div>
                                <div class="form-row cols-2">
                                    <div class="form-group">
                                        <label class="form-label">Gross Turnover / Receipts</label>
                                        <div class="input-currency">
                                            <input type="number" class="form-input" id="turnover44AD" placeholder="0" value="0">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            Digital Receipts (Bank/UPI)
                                            <span class="hint">Taxed at 6%</span>
                                        </label>
                                        <div class="input-currency">
                                            <input type="number" class="form-input" id="digital44AD" placeholder="0" value="0">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="alert alert-success" id="business-summary">
                                <strong>Business Income:</strong> Deemed Profit: ‚Çπ0
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCapitalGainsSection() {
            return `
                <div class="section-accordion">
                    <div class="section-header" onclick="toggleSectionAccordion(this)">
                        <h3>üìà Capital Gains</h3>
                        <div class="section-toggle">‚ñº</div>
                    </div>
                    <div class="section-body">
                        <div class="section-body-inner">
                            <div class="alert alert-warning">
                                <strong>Budget 2024 Rates:</strong> STCG 111A: 20% | LTCG 112A: 12.5% (‚Çπ1.25L exempt) | Other LTCG: 12.5%
                            </div>
                            <div class="form-row cols-3">
                                <div class="form-group">
                                    <label class="form-label">
                                        STCG on Equity (Sec 111A)
                                        <span class="hint">@20%</span>
                                    </label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="stcg111A" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        LTCG on Equity (Sec 112A)
                                        <span class="hint">@12.5% above ‚Çπ1.25L</span>
                                    </label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ltcg112A" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        Other LTCG (Sec 112)
                                        <span class="hint">@12.5%</span>
                                    </label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ltcgOther" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Other Short-Term Capital Gains</label>
                                <div class="input-currency">
                                    <input type="number" class="form-input" id="stcgOther" placeholder="0" value="0">
                                </div>
                            </div>
                            <div class="alert alert-success" id="capital-summary">
                                <strong>Capital Gains Tax:</strong> ‚Çπ0
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderOtherSourcesSection() {
            return `
                <div class="section-accordion">
                    <div class="section-header" onclick="toggleSectionAccordion(this)">
                        <h3>üí∞ Other Sources</h3>
                        <div class="section-toggle">‚ñº</div>
                    </div>
                    <div class="section-body">
                        <div class="section-body-inner">
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">Interest from Savings Bank</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="interestSavings" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Interest from FD/RD</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="interestFD" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">Dividend Income</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="dividendIncome" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Other Income</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="otherIncome" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-success" id="other-summary">
                                <strong>Other Sources:</strong> Total: ‚Çπ0
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleSectionAccordion(header) {
            header.classList.toggle('open');
            const body = header.nextElementSibling;
            body.classList.toggle('open');
        }

        function attachInputListeners() {
            // Attach change listeners to all inputs for auto-calculation
            document.querySelectorAll('.form-input').forEach(input => {
                input.addEventListener('change', updateSummaries);
                input.addEventListener('input', updateSummaries);
            });
        }

        function updateSummaries() {
            // Update salary summary
            const salaryEl = document.getElementById('salary-summary');
            if (salaryEl) {
                const basic = getVal('basicSalary');
                const da = getVal('da');
                const hra = getVal('hra');
                const actualRent = getVal('actualRent');
                const cityType = document.getElementById('cityType')?.value || 'metro';
                const lta = getVal('lta');
                const special = getVal('specialAllowance');
                const bonus = getVal('salaryBonus');
                const perks = getVal('perquisites');

                const basicPlusDa = basic + da;
                const cityPercent = cityType === 'metro' ? 0.50 : 0.40;
                const hraExempt1 = hra;
                const hraExempt2 = basicPlusDa * cityPercent;
                const hraExempt3 = Math.max(0, actualRent - (basicPlusDa * 0.10));
                const hraExemption = Math.min(hraExempt1, hraExempt2, hraExempt3);

                const gross = basic + da + hra + lta + special + bonus + perks;
                const net = gross - hraExemption;

                salaryEl.innerHTML = `<strong>Salary Summary:</strong> Gross: ${formatCurrency(gross)} | HRA Exemption: ${formatCurrency(hraExemption)} | <strong>Net Taxable: ${formatCurrency(net)}</strong>`;
            }

            // Update business summary
            const businessEl = document.getElementById('business-summary');
            if (businessEl) {
                const turnover = getVal('turnover44AD');
                const digital = getVal('digital44AD');
                const cash = turnover - digital;
                const profit = (digital * 0.06) + (cash * 0.08);
                businessEl.innerHTML = `<strong>Business Income:</strong> Deemed Profit: ${formatCurrency(profit)}`;
            }

            // Update other summaries similarly...
        }

        // ============================================
        // STEP 4: DEDUCTIONS
        // ============================================
        function renderDeductionsSections() {
            const container = document.getElementById('deductions-container');
            const warning = document.getElementById('deductions-new-regime-warning');

            if (TaxState.regimePreference === 'new') {
                warning.classList.remove('hidden');
            } else {
                warning.classList.add('hidden');
            }

            container.innerHTML = `
                <div class="section-accordion">
                    <div class="section-header open" onclick="toggleSectionAccordion(this)">
                        <h3>Section 80C - Investments <span class="badge" style="background: var(--color-accent-green); color: #fff;">Limit: ‚Çπ1.5L</span></h3>
                        <div class="section-toggle">‚ñº</div>
                    </div>
                    <div class="section-body open">
                        <div class="section-body-inner">
                            <div class="form-row cols-3">
                                <div class="form-group">
                                    <label class="form-label">PPF / VPF</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80C_ppf" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ELSS Mutual Funds</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80C_elss" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Life Insurance Premium</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80C_lic" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row cols-3">
                                <div class="form-group">
                                    <label class="form-label">NSC / SCSS</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80C_nsc" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Home Loan Principal</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80C_hlp" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tuition Fees (2 children)</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80C_tuition" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-accordion">
                    <div class="section-header" onclick="toggleSectionAccordion(this)">
                        <h3>Section 80D - Health Insurance</h3>
                        <div class="section-toggle">‚ñº</div>
                    </div>
                    <div class="section-body">
                        <div class="section-body-inner">
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">
                                        Self & Family Premium
                                        <span class="limit">Max ‚Çπ25K (‚Çπ50K if senior)</span>
                                    </label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80D_self" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        Parents Premium
                                        <span class="limit">Max ‚Çπ50K</span>
                                    </label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80D_parents" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-accordion">
                    <div class="section-header" onclick="toggleSectionAccordion(this)">
                        <h3>Other Deductions</h3>
                        <div class="section-toggle">‚ñº</div>
                    </div>
                    <div class="section-body">
                        <div class="section-body-inner">
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">
                                        80CCD(1B) - NPS Additional
                                        <span class="limit">Max ‚Çπ50K</span>
                                    </label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80CCD1B" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">80E - Education Loan Interest</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80E" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">
                                        80TTA - Savings Interest
                                        <span class="limit">Max ‚Çπ10K</span>
                                    </label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80TTA" placeholder="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">80G - Donations</label>
                                    <div class="input-currency">
                                        <input type="number" class="form-input" id="ded80G" placeholder="0" value="0">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================
        // TAX CALCULATIONS
        // ============================================
        function calculateNewRegimeTax(income) {
            let tax = 0;
            if (income <= 300000) tax = 0;
            else if (income <= 700000) tax = (income - 300000) * 0.05;
            else if (income <= 1000000) tax = 20000 + (income - 700000) * 0.10;
            else if (income <= 1200000) tax = 50000 + (income - 1000000) * 0.15;
            else if (income <= 1500000) tax = 80000 + (income - 1200000) * 0.20;
            else tax = 140000 + (income - 1500000) * 0.30;

            // Rebate u/s 87A for income up to 7L
            if (income <= 700000) tax = 0;
            return tax;
        }

        function calculateOldRegimeTax(income, ageGroup) {
            let exemption = 250000;
            if (ageGroup === 'senior') exemption = 300000;
            else if (ageGroup === 'supersenior') exemption = 500000;

            let tax = 0;
            if (income <= exemption) tax = 0;
            else if (income <= 500000) tax = (income - exemption) * 0.05;
            else if (income <= 1000000) tax = (500000 - exemption) * 0.05 + (income - 500000) * 0.20;
            else tax = (500000 - exemption) * 0.05 + 500000 * 0.20 + (income - 1000000) * 0.30;

            // Rebate u/s 87A for income up to 5L
            if (income <= 500000) tax = Math.max(0, tax - 12500);
            return tax;
        }

        function calculateSurcharge(tax, taxableIncome, isNewRegime, isCapitalGains = false) {
            if (isCapitalGains) {
                if (taxableIncome > 10000000) return tax * 0.15;
                else if (taxableIncome > 5000000) return tax * 0.10;
                return 0;
            }

            if (isNewRegime) {
                if (taxableIncome > 20000000) return tax * 0.25;
                else if (taxableIncome > 10000000) return tax * 0.15;
                else if (taxableIncome > 5000000) return tax * 0.10;
            } else {
                if (taxableIncome > 50000000) return tax * 0.37;
                else if (taxableIncome > 20000000) return tax * 0.25;
                else if (taxableIncome > 10000000) return tax * 0.15;
                else if (taxableIncome > 5000000) return tax * 0.10;
            }
            return 0;
        }

        function calculateAndShowResults() {
            const ageGroup = document.getElementById('ageGroup')?.value || 'general';

            // Calculate Gross Total Income
            let grossIncome = 0;

            // Salary
            if (TaxState.incomeSources.salary) {
                const basic = getVal('basicSalary');
                const da = getVal('da');
                const hra = getVal('hra');
                const lta = getVal('lta');
                const special = getVal('specialAllowance');
                const bonus = getVal('salaryBonus');
                const perks = getVal('perquisites');
                const actualRent = getVal('actualRent');
                const cityType = document.getElementById('cityType')?.value || 'metro';

                const basicPlusDa = basic + da;
                const cityPercent = cityType === 'metro' ? 0.50 : 0.40;
                const hraExemption = Math.min(hra, basicPlusDa * cityPercent, Math.max(0, actualRent - basicPlusDa * 0.10));

                grossIncome += basic + da + hra + lta + special + bonus + perks - hraExemption;
            }

            // House Property
            if (TaxState.incomeSources.house) {
                const type = document.getElementById('propertyType')?.value || 'selfoccupied';
                const rent = getVal('annualRent');
                const municipal = getVal('municipalTax');
                const interest = getVal('homeLoanInterest');

                if (type === 'selfoccupied') {
                    grossIncome -= Math.min(interest, 200000);
                } else {
                    const nav = rent - municipal;
                    const stdDed = nav * 0.30;
                    grossIncome += nav - stdDed - interest;
                }
            }

            // Business
            if (TaxState.incomeSources.business) {
                const turnover = getVal('turnover44AD');
                const digital = getVal('digital44AD');
                const cash = turnover - digital;
                grossIncome += (digital * 0.06) + (cash * 0.08);
            }

            // Capital Gains (taxed separately but added to GTI)
            let capitalGainsTax = 0;
            if (TaxState.incomeSources.capital) {
                const stcg111A = getVal('stcg111A');
                const ltcg112A = Math.max(0, getVal('ltcg112A') - 125000);
                const ltcgOther = getVal('ltcgOther');
                const stcgOther = getVal('stcgOther');

                capitalGainsTax = (stcg111A * 0.20) + (ltcg112A * 0.125) + (ltcgOther * 0.125);
                grossIncome += stcgOther; // Other STCG taxed at slab
            }

            // Other Sources
            if (TaxState.incomeSources.other) {
                grossIncome += getVal('interestSavings') + getVal('interestFD') + getVal('dividendIncome') + getVal('otherIncome');
            }

            // Calculate deductions
            let totalDeductions = 0;
            totalDeductions += Math.min(150000,
                getVal('ded80C_ppf') + getVal('ded80C_elss') + getVal('ded80C_lic') +
                getVal('ded80C_nsc') + getVal('ded80C_hlp') + getVal('ded80C_tuition')
            );
            totalDeductions += Math.min(50000, getVal('ded80CCD1B'));
            totalDeductions += Math.min(25000, getVal('ded80D_self'));
            totalDeductions += Math.min(50000, getVal('ded80D_parents'));
            totalDeductions += getVal('ded80E');
            totalDeductions += Math.min(10000, getVal('ded80TTA'));
            totalDeductions += getVal('ded80G');

            // Standard deduction
            const stdDeduction = TaxState.incomeSources.salary ? 50000 : 0;

            // Taxable income
            const taxableNew = Math.max(0, grossIncome - 75000); // New regime standard deduction is 75000
            const taxableOld = Math.max(0, grossIncome - stdDeduction - totalDeductions);

            // Calculate taxes
            const newBasicTax = calculateNewRegimeTax(taxableNew);
            const oldBasicTax = calculateOldRegimeTax(taxableOld, ageGroup);

            const newSurcharge = calculateSurcharge(newBasicTax, taxableNew, true);
            const oldSurcharge = calculateSurcharge(oldBasicTax, taxableOld, false);

            const newTaxBeforeCess = newBasicTax + newSurcharge + capitalGainsTax;
            const oldTaxBeforeCess = oldBasicTax + oldSurcharge + capitalGainsTax;

            const newCess = newTaxBeforeCess * 0.04;
            const oldCess = oldTaxBeforeCess * 0.04;

            const newTotal = newTaxBeforeCess + newCess;
            const oldTotal = oldTaxBeforeCess + oldCess;

            // Update UI
            document.getElementById('summary-gti').textContent = formatCurrency(grossIncome);
            document.getElementById('summary-deductions').textContent = formatCurrency(totalDeductions);
            document.getElementById('summary-taxable-old').textContent = formatCurrency(taxableOld);
            document.getElementById('summary-taxable-new').textContent = formatCurrency(taxableNew);

            document.getElementById('new-basic-tax').textContent = formatCurrency(newBasicTax);
            document.getElementById('new-surcharge').textContent = formatCurrency(newSurcharge);
            document.getElementById('new-marginal').textContent = '‚Çπ0';
            document.getElementById('new-cess').textContent = formatCurrency(newCess);
            document.getElementById('new-tax-total').textContent = formatCurrency(newTotal);

            document.getElementById('old-basic-tax').textContent = formatCurrency(oldBasicTax);
            document.getElementById('old-surcharge').textContent = formatCurrency(oldSurcharge);
            document.getElementById('old-marginal').textContent = '‚Çπ0';
            document.getElementById('old-cess').textContent = formatCurrency(oldCess);
            document.getElementById('old-tax-total').textContent = formatCurrency(oldTotal);

            // Recommendation
            const newCard = document.getElementById('new-regime-result');
            const oldCard = document.getElementById('old-regime-result');
            newCard.classList.remove('recommended');
            oldCard.classList.remove('recommended');

            const savings = Math.abs(newTotal - oldTotal);
            if (newTotal <= oldTotal) {
                newCard.classList.add('recommended');
                document.getElementById('savings-text').textContent = 'by choosing New Tax Regime';
            } else {
                oldCard.classList.add('recommended');
                document.getElementById('savings-text').textContent = 'by choosing Old Tax Regime';
            }
            document.getElementById('savings-amount').textContent = `You Save ${formatCurrency(savings)}`;

            // Store results
            TaxState.results = { newTotal, oldTotal, savings };
            saveState();
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            loadState();

            // Sync UI with loaded state
            if (TaxState.assesseeType) {
                const card = document.querySelector(`.assessee-card[data-type="${TaxState.assesseeType}"]`);
                if (card) selectAssesseeType(card);
            }

            if (TaxState.regimePreference) {
                selectRegime(TaxState.regimePreference);
            }

            // Restore income sources
            Object.entries(TaxState.incomeSources).forEach(([source, selected]) => {
                if (selected) {
                    const card = document.querySelector(`.income-source-card[data-source="${source}"]`);
                    if (card) card.classList.add('selected');
                }
            });

            // Go to saved step
            if (TaxState.currentStep > 1) {
                goToStep(TaxState.currentStep);
            }
        });
    </script>
</body>
</html>
